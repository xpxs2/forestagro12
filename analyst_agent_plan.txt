
# Plan for the FORESTAGRO-12 Analyst Agent

**Document Purpose:** To provide a foundational plan for building the intelligent core of the FORESTAGRO-12 platform, referred to as the "Analyst Agent." This moves the project from a foundational CRUD (Create, Read, Update, Delete) application to an intelligent, value-driven system for farmers.

---

### 1.0 Vision & Purpose

The vision is to transform the application from a simple data repository into a personalized, digital farm advisor. The Analyst Agent is the centerpiece of this transformation.

*   **Core Goal:** To analyze a farmer's self-reported data against a master database of agroforestry best practices. Its primary function is to guide the farmer toward improving their sustainability, increasing their potential yield, and, most importantly, becoming "MRV-ready" (Measurement, Reporting, and Verification).

*   **Persona:** The agent will be an **empowering partner**. It will use encouraging, opportunity-focused language, acting as a helpful expert to guide improvement, not a critic to find faults.

*   **Value Proposition:** The agent directly answers the farmer's implicit question: "What should I do next to make my farm more valuable and sustainable?"

*   **Historical Context (The "Aha!" Insight):** The original motivation for the agent, then named the **SmartAgroAnalyst (SAA)**, was to make the dashboard intelligent. Its job is to perform a "gap analysis" by comparing the work the farmer has logged against a set of best practices required for MRV. It then finds the single easiest thing the farmer can do to increase the value of their holdings and presents it as an actionable, encouraging insight.

---

### 2.0 Core Logic: The Gap Analysis Engine

The "brain" of the agent is a gap analysis engine that powers a virtuous cycle of improvement. This engine constantly compares the farmer's reality with an ideal state.

*   **The Virtuous Cycle (Connecting Data to Value):** The agent is the primary mechanism to drive the platform's core loop:
    1.  A farmer records their **Land Use** and sustainable **Practices**.
    2.  The **Analyst Agent** analyzes this data, identifying strengths and opportunities.
    3.  Following the agent's guidance helps the farmer produce more trustworthy, high-quality data.
    4.  This trusted data can be verified, unlocking **FinTech** opportunities and direct **Market** access.
    5.  The realized financial benefit incentivizes the farmer to record more and better data, completing the loop.

*   **2.1 Farmer's Reality ("What IS"):** This is the data captured from the farmer through a process of **Progressive Disclosure**. The app will not overwhelm the user initially but will guide them to build a complete profile over time: first the plot, then the assets (trees, crops), and then the practices. This rich dataset is the fuel for the engine.

---

### 3.0 NEW: Mandatory Logging & Notification System

**Core Principle:** To build trust and provide a verifiable audit trail, every significant activity on the platform must be logged. All results generated by background agents (like the SAA) must be delivered via a clear and reliable notification system.

*   **3.1 The Immutable Activity Log:**
    *   **What it is:** A dedicated, append-only collection in Firestore named `activity_log`.
    *   **How it works:** Every key action creates a timestamped document in this log. This is non-negotiable.
    *   **Examples of Logged Activities:**
        *   `user.login`
        *   `plot.created`
        *   `practice.logged` (e.g., Farmer logs use of compost)
        *   `saa.report.requested` (Farmer clicks "Generate Advisory Report")
        *   `saa.report.generated` (SAA finishes its work and saves the PDF)
        *   `mrv.report.generated`
    *   **Purpose:** This log is the foundational source of truth for all verification and auditing. It proves what happened and when.

*   **3.2 The Dual Notification System:**
    *   **What it is:** A system to ensure farmers never miss important updates, especially from asynchronous tasks like report generation.
    *   **How it works:** When a background agent completes a task (e.g., SAA finishes a report), it triggers a notification function.
    *   **The Function's Job:** To write a new notification document to a `notifications` collection in Firestore. This document contains:
        *   `userId`: The farmer to notify.
        *   `message`: A simple, human-readable message (e.g., "Your advisory report for the Hillside Plot is ready.").
        *   `link`: A direct URL to the result (e.g., the report page or the generated PDF).
        *   `status`: "unread" or "read".

*   **3.3 Delivery to the Farmer:**
    *   **Central Notices Panel:** The main Farmer's Dashboard will have a "Central Notices" area that displays all unread notifications from the `notifications` collection. This is the central hub for all updates.
    *   **Contextual Delivery:** The page where the request was made will also listen for relevant notifications. For example, after clicking "Generate Advisory Report" on the Practices page, that page will update to show a "View Report" link once the `saa.report.generated` notification arrives.

This closed-loop system ensures that every action is accounted for and every result is delivered, making the platform transparent, reliable, and trustworthy for the farmer, auditors, and market partners.
