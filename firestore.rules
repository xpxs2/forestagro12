
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // This function checks if the user is a staff member by seeing if their UID
    // exists as a document in the /staff collection.
    function isStaff() {
      return request.auth != null && exists(/databases/$(database)/documents/staff/$(request.auth.uid));
    }

    // Rule 1: A user can read and write their own document in the 'users' collection.
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Rule 2: Staff members have full read/write access to ALL documents.
    // This allows the staff app ("agro-vista20-44092715") to manage all data.
    // This rule is evaluated alongside the one above.
    match /{document=**} {
      allow read, write: if isStaff();
    }
  }
}
